<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" type="text/css" href="styles/desktop.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.7.2/css/all.min.css"
        integrity="sha512-Evv84Mr4kqVGRNSgIGL/F/aIDqQb7xQ2vcrdIwxfjThSH8CSR7PBEakCr51Ck+w+/U6swU2Im1vVX0SVk9ABhg=="
        crossorigin="anonymous" referrerpolicy="no-referrer">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" 
    rel="stylesheet">
    <title>Desktop</title>
</head>
<body class="d-flex flex-column min-vh-100">
    <header>
        <div class="header-icons d-flex justify-content-between">
            <div class="left-header">
                <i class="fa-brands fa-apple fa-xl"></i>
            </div>
            <div class="right-header gap-3 d-flex align-items-center">
                <span id="time"></span>
                <i class="fa-solid fa-magnifying-glass fa-md"></i>
                <i class="fa-solid fa-wifi fa-lg"></i>
                <i class="fa-solid fa-battery-full fa-xl"></i>   
            </div>
        </div>
    </header>

    <main class="flex-grow-1">
        <div class="desktop-container d-flex flex-column mt-3">

        <!--About Me-->
            <div class="desktop-icon" onclick="openWindow('about')">
                <img src="image/finder.png" alt="About me" width="64" height="64">
                <p class="label-icon">About Me</p>
            </div>
           
        <!--Resume--> 
            <div class="desktop-icon" onclick="openWindow('resume')">
                <img src="image/contacts.png" alt="Resume" width="64" height="64">
                <p class="label-icon">Resume</p>
            </div>

        <!--Projects-->
            <div class="desktop-icon" onclick="openWindow('projects')">
                <img src="image/page.png" alt="Projects" width="64" height="64">
                <p class="label-icon">Projects</p>
            </div> 

        <!--Weather App-->
            <div class="desktop-icon" onclick="openWindow('weather')">
                <img src="image/weather.png" alt="Weather App" width="64" height="64">
                <p class="label-icon">Weather</p>
            </div>    

        </div>
    </main>

    <!-- Reusable Window Template -->
     <div id="window-template" class="window hidden">
        <div class="window-header">
            <div class="traffic-lights">
                <div class="traffic-light red close" onclick="closeWindow(this)"></div>
                <div class="traffic-light yellow minimize" onclick="minimizeWindow(this)"></div>
                <div class="traffic-light green maximize" onclick="maximizeWindow(this)"></div>
            </div>
            <div class="window-title">Window</div>
        </div>
        <div class="window-content">
            <iframe src="" class="iframe-content"></iframe>
        </div>
            
     </div>

    <footer class="mt-auto d-flex justify-content-center">
        <ul class="d-flex list-unstyled mb-1">
            <li class="ps-2"><a class="fa-brands fa-facebook" 
                href="https://www.facebook.com/cheezeii" target="_blank"
                data-bs-toggle="tooltip" data-bs-placement="top" title="Facebook"></a></li>
            <li><a class="fa-brands fa-github" 
                href="https://github.com/ssaipin" target="_blank"
                data-bs-toggle="tooltip" data-bs-placement="top" title="GitHub"></a></li>
            <li><a class="fa-brands fa-instagram" 
                href="https://www.instagram.com/sp.gmm/" target="_blank"
                data-bs-toggle="tooltip" data-bs-placement="top" title="Instagram"></a></li>
            <li class="pe-2"><a class="fa-brands fa-codepen" 
                href="https://codepen.io/ssaipin" target="_blank"
                data-bs-toggle="tooltip" data-bs-placement="top" title="CodePen"></a></li>
        </ul>
    </footer>

    <script
        src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js">
    </script> 

    <script>
        document.addEventListener("DOMContentLoaded", function () {
            const tooltipTriggerList = [].slice.call(document.querySelectorAll('[data-bs-toggle="tooltip"]'));
            tooltipTriggerList.map(function (tooltipTriggerEl) {
                return new bootstrap.Tooltip(tooltipTriggerEl, {
                    offset: [0, 20] // [horizontal, vertical] 
                });
            });
        });

        let openWindows = [];
        let draggable = null;
        let isDragging = false;
        let dragOffset = { x: 0, y: 0 };

        //Window configuration
        const windowConfigs = {
            'about': { title: 'About Me', src: 'about.html' },
            'resume': { title: 'Resume', src: 'resume.pdf' },
            'projects': { title: 'Projects', src: 'project.html' },
            'weather': { title: 'Weather', src: 'https://gao-weather-app.netlify.app/' }
        };

        function openWindow(id) {
            // Get config from windowConfigs
            const config = windowConfigs[id];
            if (!config) 
            return;

            //Prevent duplicate windows    
            if  (document.getElementById(id + "-window"))
            return;

            // Clone the window template
            const template = document.getElementById('window-template');
            const newWindow = template.cloneNode(true);
            newWindow.id = id + "-window";
            newWindow.classList.remove('hidden');

            //Set window title and iframe source
            newWindow.querySelector('.window-title').textContent = config.title;
            newWindow.querySelector('iframe').src = config.src;

            // Add the new window to the body
            document.body.appendChild(newWindow);
            makeDraggable(newWindow); // make it draggable

            //Position the window
            centerWindow(newWindow);
        }
        function closeWindow(el) {
            el.closest('.window').remove();
        }

        function minimizeWindow(el) {
            const window = el.closest('.window');
            const content = window.querySelector('.window-content');

            if (content.style.display !== "none") {
                content.style.display = "block";
                window.style.height = "400px";
        } else {
                content.style.display = "none";
                window.style.height = "40px";
            }
        }

        function maximizeWindow(el) {
            const window = el.closest('.window');
            
            if (!window.classList.contains('maximized')) {
       
                //Apply full screen 
                window.style.width = "100vw";
                window.style.height = "100vh";
                window.style.top = "0%";
                window.style.left = "0%";
                window.style.transform = 'none';

                window.classList.add('maximized');
    
            } else {
                //Restore original size and position in center               
                centerWindow(window);
                
                window.classList.remove('maximized');
            }
        }
        function centerWindow(window) {
            window.style.position = 'fixed';
            window.style.width = '900px';
            window.style.height = '700px';
            window.style.left = '50%';
            window.style.top = '50%';
            window.style.transform = 'translate(-50%, -50%)';
        }

        // Make windows draggable
        function makeDraggable(windowEl) {
            const header = windowEl.querySelector(".window-header");

            header.addEventListener("mousedown", (e) => {
            isDragging = true;
            draggable = windowEl;

            dragOffset.x = e.clientX - windowEl.getBoundingClientRect().left;
            dragOffset.y = e.clientY - windowEl.getBoundingClientRect().top;

            windowEl.style.position = "fixed"; // important for free movement
            windowEl.style.zIndex = 1000; // bring to front while dragging
            });
        }

        document.addEventListener("mousemove", (e) => {
            if (!isDragging || !draggable) return;

            draggable.style.left = e.clientX - dragOffset.x + "px";
            draggable.style.top = e.clientY - dragOffset.y + "px";
            draggable.style.transform = "none"; // disable center transform while dragging
    });

        document.addEventListener("mouseup", () => {
            isDragging = false;
            draggable = null;
    });

    </script>
</body>
</html>